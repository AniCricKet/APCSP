<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Uploading files (research reqd)</h1><p class="page-description">Upload files through a Web Application.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-02-15T00:00:00-06:00" itemprop="datePublished">
        Feb 15, 2023
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/nighthawkcoders/APCSP/tree/master/_notebooks/2023-02-15-PBL-updload.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/APCSP/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/nighthawkcoders/APCSP/master?filepath=_notebooks%2F2023-02-15-PBL-updload.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/APCSP/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/nighthawkcoders/APCSP/blob/master/_notebooks/2023-02-15-PBL-updload.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/APCSP/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fnighthawkcoders%2FAPCSP%2Fblob%2Fmaster%2F_notebooks%2F2023-02-15-PBL-updload.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/APCSP/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Research-new-Technique">Research new Technique </a></li>
<li class="toc-entry toc-h2"><a href="#Uploading-content-using-Flask-(not-JavaScript)">Uploading content using Flask (not JavaScript) </a>
<ul>
<li class="toc-entry toc-h3"><a href="#A-Basic-File-Upload-Form">A Basic File Upload Form </a></li>
<li class="toc-entry toc-h3"><a href="#Refer-to-the-files-in-upload.py-folder-and-start-implementing-uploads-in-your-sponsor-project.">Refer to the files in upload.py folder and start implementing uploads in your sponsor project. </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Hacks---Mostly-Research-oriented">Hacks - Mostly Research oriented </a></li>
<li class="toc-entry toc-h1"><a href="#1-add-additional-content">1 add additional content </a></li>
<li class="toc-entry toc-h1"><a href="#2-add-additional-description-and-capabilities">2 add additional description and capabilities </a></li>
<li class="toc-entry toc-h1"><a href="#3-establish-a-strategy-to-manage-data-being-stored-through-Amazon-S3-bucket">3 establish a strategy to manage data being stored through Amazon S3 bucket </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-02-15-PBL-updload.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Research-new-Technique">
<a class="anchor" href="#Research-new-Technique" aria-hidden="true"><span class="octicon octicon-link"></span></a>Research new Technique<a class="anchor-link" href="#Research-new-Technique"> </a>
</h2>
<blockquote>
<p>To work with 2-server configuration it will be necessary to rework this blog to support POSTing images to Flask.</p>
<ul>
<li>
<a href="https://jdhao.github.io/2020/04/12/build_webapi_with_flask_s2/">Build Flask API</a>- <a href="https://www.edureka.co/community/163788/javascript-upload-file#:~:text=school%20approach%20%2D%20xhr-,let%20photo%20%3D%20document.,photo%22%2C%20photo">Upload and Post</a>%3B%20req.)</li>
</ul>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Uploading-content-using-Flask-(not-JavaScript)">
<a class="anchor" href="#Uploading-content-using-Flask-(not-JavaScript)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Uploading content using Flask (not JavaScript)<a class="anchor-link" href="#Uploading-content-using-Flask-(not-JavaScript)"> </a>
</h2>
<p>A common feature in web applications is to let users upload files to the server. The HTTP protocol documents the mechanism for a client to upload a file, and the Flask framework fully supports it.</p>
<p>Suggestion is to READ the CODE, lots of comments and start implementing.<br>
See <a href="https://github.com/nighthawkcoders/pages_python/blob/main/contenty/app_content.py">app_content.py</a> and the hacks in the file. Note the import secure_filename from werkzeug.utils.</p>
<h3 id="A-Basic-File-Upload-Form">
<a class="anchor" href="#A-Basic-File-Upload-Form" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Basic File Upload Form<a class="anchor-link" href="#A-Basic-File-Upload-Form"> </a>
</h3>
<p>See <a href="https://github.com/nighthawkcoders/pages_python/blob/main/contenty/templates/contenty/content.html">content.html</a>.<br>
From a high-level perspective, a client uploading a file is treated the same as any other form data submission. In other words, you have to define an HTML form with a file field in it.  The HTML <code>&lt;input type="file"&gt;</code> defines a file-select field and a "Browse" button for file uploads.</p>
<p>An HTTP multipart request is an HTTP request that HTTP clients construct to send files and data over to an HTTP Server. It is commonly used by browsers and HTTP clients to upload files to the server.  This is server side implementation and needs to be adapted for JavaScript.</p>

<pre><code>&lt;form id="upload" enctype="multipart/form-data" action = "url_for('content.upload')" method = "POST"&gt;</code></pre>
<p>The enctype attribute defines how the browser should format the data before it is submitted to the server.<br>
multipart/form-data: This format is required when at least one of the fields in the form is a file field.</p>
<h3 id="Refer-to-the-files-in-upload.py-folder-and-start-implementing-uploads-in-your-sponsor-project.">
<a class="anchor" href="#Refer-to-the-files-in-upload.py-folder-and-start-implementing-uploads-in-your-sponsor-project." aria-hidden="true"><span class="octicon octicon-link"></span></a>Refer to the files in <a href="https://github.com/nighthawkcoders/pages_python/blob/main/uploady/app_upload.py">upload.py</a> folder and start implementing uploads in your sponsor project.<a class="anchor-link" href="#Refer-to-the-files-in-upload.py-folder-and-start-implementing-uploads-in-your-sponsor-project."> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">app_upload</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">'upload'</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span>
                       <span class="n">url_prefix</span><span class="o">=</span><span class="s1">'/upload'</span><span class="p">,</span>
                       <span class="n">template_folder</span><span class="o">=</span><span class="s1">'templates/uploady/'</span><span class="p">,</span>
                       <span class="n">static_folder</span><span class="o">=</span><span class="s1">'static'</span><span class="p">,</span>
                       <span class="n">static_url_path</span><span class="o">=</span><span class="s1">'static'</span><span class="p">)</span>

<span class="sd">''' </span>
<span class="sd">Objective of the ideas started with this page is to manage uploading content to a Web Site</span>
<span class="sd">Code provided allows user to upload Image into static/uploads folder </span>
<span class="sd">'''</span>
<span class="c1"># ... An Image is often called a picture, it works with &lt;image ...&gt; tage in HTML</span>
<span class="c1"># ... Supported types jpeg, gif, png, apng, svg, bmp, bmp ico, png ico.</span>

<span class="sd">'''</span>
<span class="sd">Hack #1 add additional content</span>
<span class="sd">'''</span>
<span class="c1"># Additional Content</span>
<span class="c1"># ... Video, Comma Seperated Values (CSV), Code File (py,java)</span>
<span class="c1"># ... One or more uploading capabilities can be provided to support needs of your project</span>

<span class="sd">'''</span>
<span class="sd">Hack #2 add additional description and capabilities</span>
<span class="sd">'''</span>
<span class="c1"># Establish a database record that keeps track of content and establishes meta data</span>
<span class="c1"># ... user who uploaded</span>
<span class="c1"># ... description</span>
<span class="c1"># Combine Note and Image upload into single activie</span>
<span class="c1"># ... description of Note is Markdown text</span>
<span class="c1"># ... try using uploaded image in notes</span>
<span class="c1"># ... think about easier markdown UI for user of Note and Images</span>

<span class="sd">'''</span>
<span class="sd">Hack #3 establish a strategy to manage data being stored through Amazon S3 bucket</span>
<span class="sd">'''</span>
<span class="c1"># AWS S3 Object Container is a system used to manage content</span>
<span class="c1"># ... S3 Bucket Concept: https://www.youtube.com/watch?v=-VVC7uTNJX8</span>


<span class="c1"># A global variable is used to provide feedback for session to users, but is considered short term solution</span>
<span class="n">files_uploaded</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">upload_save</span><span class="p">(</span><span class="n">file_object</span><span class="p">):</span>
    <span class="c1"># set path to location defined in __init__.py</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'UPLOAD_FOLDER'</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># Create a new directory because it does not exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># secure_filename checks for integrity of filename, avoids hacking</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file_object</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># os.path.join adds path for uploads</span>
    <span class="n">upload_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="c1"># save file object to upload location</span>
    <span class="n">file_object</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">upload_location</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span>


<span class="c1"># Page to upload content page</span>
<span class="nd">@app_upload</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">upload</span><span class="p">():</span>
    <span class="c1"># grab user object (uo) based on current login</span>
    <span class="n">uo</span> <span class="o">=</span> <span class="n">user_by_id</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">userID</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">uo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># extract user record (Dictionary)</span>
    <span class="c1"># load content page</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'upload.html'</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files_uploaded</span><span class="p">)</span>


<span class="c1"># Notes create/add</span>
<span class="nd">@app_upload</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/upload/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">uploader</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># grab file object (fo) from user input The fo variable holds the submitted file object. This is an instance</span>
        <span class="c1"># of class FileStorage, which Flask imports from Werkzeug.</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">'filename'</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">upload_save</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span>

        <span class="c1"># inserts location of object to feedback list</span>
        <span class="n">files_uploaded</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">'uploads_endpoint'</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># errors handled, but specific errors are not messaged to user</span>
        <span class="k">pass</span>
    <span class="c1"># reload content page</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">'upload.upload'</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Hacks---Mostly-Research-oriented">
<a class="anchor" href="#Hacks---Mostly-Research-oriented" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hacks - Mostly Research oriented<a class="anchor-link" href="#Hacks---Mostly-Research-oriented"> </a>
</h2>
<blockquote>
<h1 id="1-add-additional-content">
<a class="anchor" href="#1-add-additional-content" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 add additional content<a class="anchor-link" href="#1-add-additional-content"> </a>
</h1>
<p>Additional Content</p>
<ul>
<li>Video, Comma Separated Values (CSV), Code File (py,java)</li>
<li>Add additional capabilities to support needs of your project. Think about how to use uploads for different parts of System<ul>
<li>About Page with user specific uploads</li>
<li>Thumb nail for User Login</li>
<li>etc</li>
</ul>
</li>
</ul>
<h1 id="2-add-additional-description-and-capabilities">
<a class="anchor" href="#2-add-additional-description-and-capabilities" aria-hidden="true"><span class="octicon octicon-link"></span></a>2 add additional description and capabilities<a class="anchor-link" href="#2-add-additional-description-and-capabilities"> </a>
</h1>
<ul>
<li>Establish a database record that keeps track of content and establishes meta data versus current list implementation<ul>
<li>Combine Note and Image upload into single blueprint and MVC.  Most pictures have notes and vice-versa,</li>
<li>Consider adding user, you may want to filter Uploads/Notes to the logged in user, this can be done within same model.</li>
<li>Add description to Upload, or add Image to Note.  Description should be Markdown.</li>
</ul>
</li>
<li>Think about easier UI for user of Note and Images uploads</li>
</ul>
<h1 id="3-establish-a-strategy-to-manage-data-being-stored-through-Amazon-S3-bucket">
<a class="anchor" href="#3-establish-a-strategy-to-manage-data-being-stored-through-Amazon-S3-bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>3 establish a strategy to manage data being stored through Amazon S3 bucket<a class="anchor-link" href="#3-establish-a-strategy-to-manage-data-being-stored-through-Amazon-S3-bucket"> </a>
</h1>
<ul>
<li>AWS S3 Object Container is a system used to manage content</li>
<li>AWS would replace putting Upload on local file system, but all the database features from Hack #2 would remain.</li>
<li>S3 Bucket Concept:<a href="https://www.youtube.com/watch?v=-VVC7uTNJX8">https://www.youtube.com/watch?v=-VVC7uTNJX8</a>
</li>
</ul>
</blockquote>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/APCSP/2023/02/15/PBL-updload.html" hidden></a>
</article>
